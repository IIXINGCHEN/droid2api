<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ å¯†é’¥æ± é€‰æ‹© UI æµ‹è¯•é¡µé¢</title>
    <link rel="stylesheet" href="../public/style.css">
    <style>
        body {
            padding: 40px;
        }
        .test-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        .test-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        .test-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .test-result {
            margin-top: 20px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .test-result h3 {
            color: #333;
            margin-bottom: 10px;
        }
        .test-result pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-title">
                    <h1>ğŸ¯ å¯†é’¥æ± é€‰æ‹© UI æµ‹è¯•</h1>
                    <p class="subtitle">æµ‹è¯•å››ä¸ªæ ¸å¿ƒåŠŸèƒ½æŒ‰é’®çš„æ± å­é€‰æ‹©èƒ½åŠ›</p>
                </div>
            </div>
        </header>

        <!-- æµ‹è¯•åŒºåŸŸ 1ï¼šæ·»åŠ å¯†é’¥ -->
        <div class="test-section">
            <h2>1ï¸âƒ£ æ·»åŠ å¯†é’¥æµ‹è¯•</h2>
            <p>æµ‹è¯•æ·»åŠ å¯†é’¥æ—¶é€‰æ‹©æ± å­åŠŸèƒ½</p>
            <div class="test-buttons">
                <button onclick="testShowAddKeyModal()" class="btn btn-primary">æ‰“å¼€æ·»åŠ å¯†é’¥å¼¹çª—</button>
                <button onclick="testAddKey()" class="btn btn-success">æ¨¡æ‹Ÿæ·»åŠ å¯†é’¥</button>
            </div>
            <div id="addKeyResult" class="test-result" style="display: none;">
                <h3>æµ‹è¯•ç»“æœï¼š</h3>
                <pre id="addKeyOutput"></pre>
            </div>
        </div>

        <!-- æµ‹è¯•åŒºåŸŸ 2ï¼šæ‰¹é‡å¯¼å…¥ -->
        <div class="test-section">
            <h2>2ï¸âƒ£ æ‰¹é‡å¯¼å…¥æµ‹è¯•</h2>
            <p>æµ‹è¯•æ‰¹é‡å¯¼å…¥æ—¶é€‰æ‹©æ± å­åŠŸèƒ½</p>
            <div class="test-buttons">
                <button onclick="testShowBatchImportModal()" class="btn btn-secondary">æ‰“å¼€æ‰¹é‡å¯¼å…¥å¼¹çª—</button>
                <button onclick="testBatchImport()" class="btn btn-success">æ¨¡æ‹Ÿæ‰¹é‡å¯¼å…¥</button>
            </div>
            <div id="batchImportResult" class="test-result" style="display: none;">
                <h3>æµ‹è¯•ç»“æœï¼š</h3>
                <pre id="batchImportOutput"></pre>
            </div>
        </div>

        <!-- æµ‹è¯•åŒºåŸŸ 3ï¼šå¯¼å‡ºå¯†é’¥ -->
        <div class="test-section">
            <h2>3ï¸âƒ£ å¯¼å‡ºå¯†é’¥æµ‹è¯•</h2>
            <p>æµ‹è¯•å¯¼å‡ºå¯†é’¥æ—¶é€‰æ‹©æ± å­å’Œæ ¼å¼åŠŸèƒ½</p>
            <div class="test-buttons">
                <button onclick="testShowExportKeysModal()" class="btn btn-secondary">æ‰“å¼€å¯¼å‡ºå¯†é’¥å¼¹çª—</button>
                <button onclick="testExportKeys()" class="btn btn-success">æ¨¡æ‹Ÿå¯¼å‡ºå¯†é’¥</button>
            </div>
            <div id="exportKeysResult" class="test-result" style="display: none;">
                <h3>æµ‹è¯•ç»“æœï¼š</h3>
                <pre id="exportKeysOutput"></pre>
            </div>
        </div>

        <!-- æµ‹è¯•åŒºåŸŸ 4ï¼šæ‰¹é‡æµ‹è¯• -->
        <div class="test-section">
            <h2>4ï¸âƒ£ æ‰¹é‡æµ‹è¯•æµ‹è¯•</h2>
            <p>æµ‹è¯•æ‰¹é‡æµ‹è¯•æ—¶é€‰æ‹©æ± å­å’Œå¹¶å‘æ•°åŠŸèƒ½</p>
            <div class="test-buttons">
                <button onclick="testShowBatchTestModal()" class="btn btn-info">æ‰“å¼€æ‰¹é‡æµ‹è¯•å¼¹çª—</button>
                <button onclick="testBatchTest()" class="btn btn-success">æ¨¡æ‹Ÿæ‰¹é‡æµ‹è¯•</button>
            </div>
            <div id="batchTestResult" class="test-result" style="display: none;">
                <h3>æµ‹è¯•ç»“æœï¼š</h3>
                <pre id="batchTestOutput"></pre>
            </div>
        </div>

        <!-- æµ‹è¯•åŒºåŸŸ 5ï¼šæ± å­é€‰é¡¹åŠ è½½ -->
        <div class="test-section">
            <h2>5ï¸âƒ£ æ± å­é€‰é¡¹åŠ è½½æµ‹è¯•</h2>
            <p>æµ‹è¯•åŠ¨æ€åŠ è½½æ± å­é€‰é¡¹åŠŸèƒ½</p>
            <div class="test-buttons">
                <button onclick="testLoadPoolOptions()" class="btn btn-primary">åŠ è½½æ± å­é€‰é¡¹</button>
                <button onclick="testInitializeAllSelects()" class="btn btn-success">åˆå§‹åŒ–æ‰€æœ‰ä¸‹æ‹‰æ¡†</button>
            </div>
            <div id="poolOptionsResult" class="test-result" style="display: none;">
                <h3>æµ‹è¯•ç»“æœï¼š</h3>
                <pre id="poolOptionsOutput"></pre>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ‰€æœ‰æ¨¡æ€æ¡† -->
    <div id="addKeyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addKeyModal')">&times;</span>
            <h2>â• æ·»åŠ å¯†é’¥</h2>
            <div class="form-group">
                <label for="newKeyInput">å¯†é’¥ï¼š</label>
                <input type="text" id="newKeyInput" placeholder="fk-xxxxxxxx" class="modal-input" />
            </div>
            <div class="form-group">
                <label for="newKeyPoolGroup">ğŸ¯ æ‰€å±å¯†é’¥æ± ï¼š</label>
                <select id="newKeyPoolGroup" class="modal-input">
                    <option value="">é»˜è®¤æ±  (default)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="newKeyNotes">å¤‡æ³¨ï¼š</label>
                <textarea id="newKeyNotes" placeholder="å¤‡æ³¨(å¯é€‰)" class="modal-textarea"></textarea>
            </div>
            <button onclick="simulateAddKey()" class="btn btn-primary">æ·»åŠ </button>
        </div>
    </div>

    <div id="batchImportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('batchImportModal')">&times;</span>
            <h2>ğŸ“¤ æ‰¹é‡å¯¼å…¥å¯†é’¥</h2>
            <div class="form-group">
                <label for="batchImportPoolGroup">ğŸ¯ å¯¼å…¥åˆ°å“ªä¸ªæ± ï¼š</label>
                <select id="batchImportPoolGroup" class="modal-input">
                    <option value="">é»˜è®¤æ±  (default)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="batchKeysInput">å¯†é’¥åˆ—è¡¨ (æ¯è¡Œä¸€ä¸ª)ï¼š</label>
                <textarea id="batchKeysInput" placeholder="fk-xxx&#10;fk-yyy&#10;fk-zzz" class="modal-textarea large"></textarea>
            </div>
            <button onclick="simulateBatchImport()" class="btn btn-primary">ğŸ“¥ å¼€å§‹å¯¼å…¥</button>
            <div id="importResult" class="import-result"></div>
        </div>
    </div>

    <div id="exportKeysModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('exportKeysModal')">&times;</span>
            <h2>ğŸ“¥ å¯¼å‡ºå¯†é’¥</h2>
            <div class="form-group">
                <label>ğŸ¯ å¯¼å‡ºå“ªä¸ªæ± ï¼š</label>
                <div class="checkbox-group">
                    <label class="filter-checkbox">
                        <input type="checkbox" id="exportAllPools" checked onchange="toggleExportAllPools()">
                        å…¨éƒ¨æ±  (å¯¼å‡ºæ‰€æœ‰å¯†é’¥)
                    </label>
                </div>
                <div id="exportPoolOptions" style="margin-top: 10px; display: none;">
                    <select id="exportPoolGroup" class="modal-input" multiple size="5">
                        <option value="default">é»˜è®¤æ±  (default)</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>å¯¼å‡ºæ ¼å¼ï¼š</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="exportFormat" value="json" checked>
                        JSON (å®Œæ•´æ•°æ®)
                    </label>
                    <label>
                        <input type="radio" name="exportFormat" value="text">
                        çº¯æ–‡æœ¬ (ä»…å¯†é’¥)
                    </label>
                    <label>
                        <input type="radio" name="exportFormat" value="csv">
                        CSV (è¡¨æ ¼)
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label>çŠ¶æ€ç­›é€‰ï¼š</label>
                <select id="exportStatusFilter" class="modal-input">
                    <option value="all">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="active">ä»…å¯ç”¨</option>
                    <option value="disabled">ä»…ç¦ç”¨</option>
                    <option value="banned">ä»…å°ç¦</option>
                </select>
            </div>
            <button onclick="simulateExportKeys()" class="btn btn-primary">ğŸ“¥ å¯¼å‡ºæ–‡ä»¶</button>
        </div>
    </div>

    <div id="batchTestModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('batchTestModal')">&times;</span>
            <h2>ğŸ§ª æ‰¹é‡æµ‹è¯•å¯†é’¥</h2>
            <div class="form-group">
                <label>ğŸ¯ æµ‹è¯•å“ªä¸ªæ± ï¼š</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="testPool" value="all" checked>
                        å…¨éƒ¨æ±  (æµ‹è¯•æ‰€æœ‰å¯†é’¥)
                    </label>
                    <label>
                        <input type="radio" name="testPool" value="specific">
                        æŒ‡å®šæ± 
                    </label>
                </div>
                <div id="testPoolOptions" style="margin-top: 10px; display: none;">
                    <select id="testPoolGroup" class="modal-input">
                        <option value="default">é»˜è®¤æ±  (default)</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="testConcurrency">æµ‹è¯•å¹¶å‘æ•°ï¼š</label>
                <input type="number" id="testConcurrency" min="1" max="10" value="5" class="modal-input" />
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="testAutoRefresh" checked>
                    æµ‹è¯•å®Œæˆåè‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
                </label>
            </div>
            <button onclick="simulateBatchTest()" class="btn btn-primary">ğŸ§ª å¼€å§‹æµ‹è¯•</button>
            <div id="testResult" class="import-result" style="margin-top: 15px;"></div>
        </div>
    </div>

    <script src="../public/app.js"></script>
    <script src="../public/pool-selection-ui.js"></script>
    <script>
        // æ¨¡æ‹Ÿ API è¯·æ±‚å‡½æ•°ï¼ˆé¿å…çœŸå®è°ƒç”¨åç«¯ï¼‰
        window.apiRequest = async function(url, method = 'GET', body = null) {
            console.log(`ğŸš€ æ¨¡æ‹Ÿ API è¯·æ±‚: ${method} ${url}`, body);

            // æ¨¡æ‹Ÿæ± å­åˆ—è¡¨æ•°æ®
            if (url === '/pool-groups') {
                return {
                    success: true,
                    data: [
                        { id: 'freebies', name: 'ç™½å«–æ± ', priority: 1, description: 'ä¼˜å…ˆæ¶ˆè€—ç™½å«–å¯†é’¥' },
                        { id: 'main', name: 'ä¸»åŠ›æ± ', priority: 2, description: 'ä»˜è´¹å¯†é’¥å…œåº•' },
                        { id: 'backup', name: 'å¤‡ç”¨æ± ', priority: 3, description: 'å¤‡ç”¨å¯†é’¥' }
                    ]
                };
            }

            // æ¨¡æ‹Ÿæ·»åŠ å¯†é’¥
            if (url === '/keys' && method === 'POST') {
                return {
                    success: true,
                    data: { id: 'key_1234567890', ...body }
                };
            }

            // æ¨¡æ‹Ÿæ‰¹é‡å¯¼å…¥
            if (url === '/keys/batch' && method === 'POST') {
                return {
                    success: true,
                    data: {
                        total: body.keys.length,
                        success: body.keys.length,
                        duplicate: 0,
                        invalid: 0
                    }
                };
            }

            // æ¨¡æ‹Ÿæ‰¹é‡æµ‹è¯•
            if (url.startsWith('/keys/test-all')) {
                return {
                    success: true,
                    data: {
                        total: 100,
                        tested: 100,
                        success: 95,
                        failed: 5,
                        banned: 5
                    }
                };
            }

            return { success: true, data: {} };
        };

        // æµ‹è¯•å‡½æ•°
        function testShowAddKeyModal() {
            showAddKeyModal();
            document.getElementById('addKeyResult').style.display = 'block';
            document.getElementById('addKeyOutput').textContent = 'âœ… æˆåŠŸæ‰“å¼€"æ·»åŠ å¯†é’¥"æ¨¡æ€æ¡†\nå·²åŠ è½½æ± å­é€‰é¡¹ï¼';
        }

        function testAddKey() {
            document.getElementById('addKeyResult').style.display = 'block';
            document.getElementById('addKeyOutput').textContent = JSON.stringify({
                key: 'fk-test-key',
                poolGroup: 'freebies',
                notes: 'æµ‹è¯•å¯†é’¥'
            }, null, 2);
        }

        function testShowBatchImportModal() {
            showBatchImportModal();
            document.getElementById('batchImportResult').style.display = 'block';
            document.getElementById('batchImportOutput').textContent = 'âœ… æˆåŠŸæ‰“å¼€"æ‰¹é‡å¯¼å…¥"æ¨¡æ€æ¡†\nå·²åŠ è½½æ± å­é€‰é¡¹ï¼';
        }

        function testBatchImport() {
            document.getElementById('batchImportResult').style.display = 'block';
            document.getElementById('batchImportOutput').textContent = JSON.stringify({
                keys: ['fk-xxx', 'fk-yyy', 'fk-zzz'],
                poolGroup: 'freebies'
            }, null, 2);
        }

        function testShowExportKeysModal() {
            showExportKeysModal();
            document.getElementById('exportKeysResult').style.display = 'block';
            document.getElementById('exportKeysOutput').textContent = 'âœ… æˆåŠŸæ‰“å¼€"å¯¼å‡ºå¯†é’¥"æ¨¡æ€æ¡†\nå·²åŠ è½½æ± å­é€‰é¡¹ï¼';
        }

        function testExportKeys() {
            document.getElementById('exportKeysResult').style.display = 'block';
            document.getElementById('exportKeysOutput').textContent = JSON.stringify({
                poolGroups: ['freebies', 'main'],
                format: 'json',
                status: 'active'
            }, null, 2);
        }

        function testShowBatchTestModal() {
            showBatchTestModal();
            document.getElementById('batchTestResult').style.display = 'block';
            document.getElementById('batchTestOutput').textContent = 'âœ… æˆåŠŸæ‰“å¼€"æ‰¹é‡æµ‹è¯•"æ¨¡æ€æ¡†\nå·²åŠ è½½æ± å­é€‰é¡¹ï¼';
        }

        function testBatchTest() {
            document.getElementById('batchTestResult').style.display = 'block';
            document.getElementById('batchTestOutput').textContent = JSON.stringify({
                poolGroup: 'freebies',
                concurrency: 5,
                autoRefresh: true
            }, null, 2);
        }

        function testLoadPoolOptions() {
            loadPoolGroupOptions('newKeyPoolGroup', true).then(() => {
                document.getElementById('poolOptionsResult').style.display = 'block';
                document.getElementById('poolOptionsOutput').textContent = 'âœ… æˆåŠŸåŠ è½½æ± å­é€‰é¡¹åˆ° newKeyPoolGroupï¼';
            });
        }

        function testInitializeAllSelects() {
            initializeAllPoolSelects().then(() => {
                document.getElementById('poolOptionsResult').style.display = 'block';
                document.getElementById('poolOptionsOutput').textContent = 'âœ… æˆåŠŸåˆå§‹åŒ–æ‰€æœ‰ä¸‹æ‹‰æ¡†çš„æ± å­é€‰é¡¹ï¼';
            });
        }

        // æ¨¡æ‹ŸæŒ‰é’®ç‚¹å‡»
        function simulateAddKey() {
            const key = document.getElementById('newKeyInput').value;
            const poolGroup = document.getElementById('newKeyPoolGroup').value;
            const notes = document.getElementById('newKeyNotes').value;
            alert(`æ¨¡æ‹Ÿæ·»åŠ å¯†é’¥ï¼š\nå¯†é’¥: ${key}\næ± å­: ${poolGroup || 'default'}\nå¤‡æ³¨: ${notes}`);
            closeModal('addKeyModal');
        }

        function simulateBatchImport() {
            const keys = document.getElementById('batchKeysInput').value.split('\n').filter(k => k.trim());
            const poolGroup = document.getElementById('batchImportPoolGroup').value;
            alert(`æ¨¡æ‹Ÿæ‰¹é‡å¯¼å…¥ï¼š\nå¯†é’¥æ•°: ${keys.length}\næ± å­: ${poolGroup || 'default'}`);
            document.getElementById('importResult').innerHTML = `
                <div class="result-summary success">
                    <h3>âœ… æˆåŠŸå¯¼å…¥ ${keys.length} ä¸ªå¯†é’¥ï¼</h3>
                    <p>ğŸ“Š æ€»æ•°: ${keys.length}</p>
                    <p>âœ… æˆåŠŸ: ${keys.length}</p>
                    <p>ğŸ”„ é‡å¤: 0</p>
                    <p>âŒ æ— æ•ˆ: 0</p>
                    <p>ğŸ¯ å¯¼å…¥åˆ°æ± : ${poolGroup || 'default'}</p>
                </div>
            `;
        }

        function simulateExportKeys() {
            const exportAll = document.getElementById('exportAllPools').checked;
            const format = document.querySelector('input[name="exportFormat"]:checked').value;
            const status = document.getElementById('exportStatusFilter').value;
            alert(`æ¨¡æ‹Ÿå¯¼å‡ºå¯†é’¥ï¼š\nå¯¼å‡ºå…¨éƒ¨: ${exportAll}\næ ¼å¼: ${format}\nçŠ¶æ€: ${status}`);
            closeModal('exportKeysModal');
        }

        function simulateBatchTest() {
            const testAll = document.querySelector('input[name="testPool"][value="all"]').checked;
            const poolGroup = document.getElementById('testPoolGroup').value;
            const concurrency = document.getElementById('testConcurrency').value;
            alert(`æ¨¡æ‹Ÿæ‰¹é‡æµ‹è¯•ï¼š\næµ‹è¯•å…¨éƒ¨: ${testAll}\næ± å­: ${poolGroup}\nå¹¶å‘æ•°: ${concurrency}`);
            document.getElementById('testResult').innerHTML = `
                <div class="result-summary success">
                    <h3>ğŸ‰ æ‰¹é‡æµ‹è¯•å®Œæˆ</h3>
                    <p>ğŸ“Š æ€»å¯†é’¥æ•°: 100 ä¸ª</p>
                    <p>ğŸ” å·²æµ‹è¯•: 100 ä¸ª</p>
                    <p>âœ… æµ‹è¯•é€šè¿‡: 95 ä¸ª</p>
                    <p>âŒ æµ‹è¯•å¤±è´¥: 5 ä¸ª</p>
                    <p>ğŸš« è‡ªåŠ¨å°ç¦: 5 ä¸ª</p>
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            setTimeout(() => {
                initializeAllPoolSelects();
            }, 1000);
        });
    </script>
</body>
</html>

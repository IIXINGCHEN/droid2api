# ğŸ—ï¸ droid2api - å®Œæ•´æ¶æ„æ–‡æ¡£

> **BaSui çš„è¶…è¯¦ç»†æ¶æ„æŒ‡å—** | æœ€åæ›´æ–°ï¼š2025-10-13

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„æ€»è§ˆ](#ç³»ç»Ÿæ¶æ„æ€»è§ˆ)
2. [è¯·æ±‚å¤„ç†æµç¨‹](#è¯·æ±‚å¤„ç†æµç¨‹)
3. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
4. [API ç«¯ç‚¹å‚è€ƒ](#api-ç«¯ç‚¹å‚è€ƒ)
5. [æ•°æ®æµå›¾](#æ•°æ®æµå›¾)
6. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„æ€»è§ˆ

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å®¢æˆ·ç«¯è¯·æ±‚                                 â”‚
â”‚            (OpenAI/Anthropic/Common æ ¼å¼)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Express æœåŠ¡å™¨ (server.js)                   â”‚
â”‚                     â€¢ ç«¯å£ï¼š3000 (å¯é…ç½®)                          â”‚
â”‚                     â€¢ é›†ç¾¤æ¨¡å¼æ”¯æŒ (å¯é€‰)                          â”‚
â”‚                     â€¢ CORS å¯ç”¨                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸­é—´ä»¶å±‚ (middleware/)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ client-auth  â”‚  log-collector    â”‚  stats-tracker      â”‚     â”‚
â”‚  â”‚ API_ACCESS   â”‚  æ—¥å¿—ç¼“å†²         â”‚  è¯·æ±‚ç»Ÿè®¡            â”‚     â”‚
â”‚  â”‚ _KEY éªŒè¯    â”‚                   â”‚                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          è·¯ç”±å±‚ (routes.js)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  å®¢æˆ·ç«¯ API (OpenAI å…¼å®¹)                                 â”‚    â”‚
â”‚  â”‚  â€¢ GET  /v1/models                                       â”‚    â”‚
â”‚  â”‚  â€¢ POST /v1/chat/completions  (è‡ªåŠ¨è½¬æ¢)                 â”‚    â”‚
â”‚  â”‚  â€¢ POST /v1/responses         (OpenAI ç›´æ¥è½¬å‘)          â”‚    â”‚
â”‚  â”‚  â€¢ POST /v1/messages          (Anthropic ç›´æ¥è½¬å‘)       â”‚    â”‚
â”‚  â”‚  â€¢ POST /v1/messages/count_tokens (Token è®¡æ•°)          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ç®¡ç† API (admin-routes.js)                              â”‚    â”‚
â”‚  â”‚  â€¢ GET/POST/PUT/PATCH/DELETE /admin/*                    â”‚    â”‚
â”‚  â”‚  â€¢ å¯†é’¥æ± ç®¡ç†ã€Token ä½¿ç”¨é‡ã€è¯·æ±‚ç»Ÿè®¡ã€æ—¥å¿—æµ            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¯†é’¥æ± ç®¡ç† (auth.js)                          â”‚
â”‚  â€¢ KeyPoolManager ç±»                                             â”‚
â”‚  â€¢ è½®è¯¢ç®—æ³• (6ç§)                                                 â”‚
â”‚  â€¢ å¥åº·æ£€æŸ¥                                                       â”‚
â”‚  â€¢ è‡ªåŠ¨å°ç¦ (402 é”™è¯¯)                                            â”‚
â”‚  â€¢ å¤šçº§å¯†é’¥æ±  (v1.5+)                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¼å¼è½¬æ¢å±‚ (transformers/)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  è¯·æ±‚è½¬æ¢             â”‚  å“åº”è½¬æ¢                      â”‚       â”‚
â”‚  â”‚  â€¢ request-anthropic â”‚  â€¢ response-anthropic         â”‚       â”‚
â”‚  â”‚  â€¢ request-openai    â”‚  â€¢ response-openai            â”‚       â”‚
â”‚  â”‚  â€¢ request-common    â”‚                               â”‚       â”‚
â”‚  â”‚  â€¢ headers-common    â”‚                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HTTP è¿æ¥æ±  (utils/http-client.js)           â”‚
â”‚  â€¢ Keep-Alive è¿æ¥å¤ç”¨                                            â”‚
â”‚  â€¢ è¶…æ—¶æ§åˆ¶ (120s)                                                â”‚
â”‚  â€¢ æ€§èƒ½ä¼˜åŒ– (å»¶è¿Ÿé™ä½ 80%)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸Šæ¸¸ LLM API (Factory AI)                    â”‚
â”‚  â€¢ api.factory.us.aliyun.ws/v1/messages                          â”‚
â”‚  â€¢ api.factory.us.aliyun.ws/v1/responses                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å“åº”å¤„ç†                                  â”‚
â”‚  â€¢ Token ä½¿ç”¨é‡æå–                                               â”‚
â”‚  â€¢ æ ¼å¼è½¬æ¢ (Anthropic â†’ OpenAI)                                 â”‚
â”‚  â€¢ æµå¼/éæµå¼å“åº”å¤„ç†                                            â”‚
â”‚  â€¢ è¯·æ±‚ç»Ÿè®¡è®°å½•                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         è¿”å›å®¢æˆ·ç«¯                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ è¯·æ±‚å¤„ç†æµç¨‹

### æµç¨‹å›¾

```mermaid
graph TD
    A[å®¢æˆ·ç«¯è¯·æ±‚] --> B{API_ACCESS_KEY éªŒè¯}
    B -->|å¤±è´¥| C[403 Forbidden]
    B -->|æˆåŠŸ| D[æ—¥å¿—æ”¶é›†ä¸­é—´ä»¶]
    D --> E[ç»Ÿè®¡è¿½è¸ªä¸­é—´ä»¶]
    E --> F{è·¯ç”±åŒ¹é…}

    F --> G[/v1/models]
    F --> H[/v1/chat/completions]
    F --> I[/v1/responses]
    F --> J[/v1/messages]
    F --> K[/admin/*]

    H --> L{æ¨¡å‹ç±»å‹åˆ¤æ–­}
    L -->|Anthropic| M[transformToAnthropic]
    L -->|OpenAI| N[transformToOpenAI]
    L -->|Common| O[transformToCommon]

    M --> P[å¯†é’¥æ± è·å–å¯†é’¥]
    N --> P
    O --> P

    P --> Q{å¯†é’¥å¯ç”¨?}
    Q -->|å¦| R[500 å¯†é’¥æ± é”™è¯¯]
    Q -->|æ˜¯| S[HTTP è¿æ¥æ± è¯·æ±‚]

    S --> T{å“åº”çŠ¶æ€}
    T -->|402| U[å°ç¦å¯†é’¥ + è¿”å›é”™è¯¯]
    T -->|400-599| V[è¿”å›ä¸Šæ¸¸é”™è¯¯]
    T -->|200| W{æµå¼å“åº”?}

    W -->|æ˜¯| X[æµå¼è½¬æ¢ + è½¬å‘]
    W -->|å¦| Y[éæµå¼è½¬æ¢ + è¿”å›]

    X --> Z[è®°å½• Token ä½¿ç”¨é‡]
    Y --> Z
    Z --> AA[è¿”å›å®¢æˆ·ç«¯]
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. æœåŠ¡å™¨å…¥å£ (server.js)

**èŒè´£**ï¼šExpress æœåŠ¡å™¨å¯åŠ¨ï¼Œæ”¯æŒé›†ç¾¤æ¨¡å¼

**å…³é”®ä»£ç **ï¼š
```javascript
// å•è¿›ç¨‹æ¨¡å¼
const app = express();
app.use(cors());
app.use(express.json({ limit: '50mb' }));
app.use('/admin', adminRoutes);
app.use('/', routes);
app.listen(PORT);

// é›†ç¾¤æ¨¡å¼ (CLUSTER_MODE=true)
if (cluster.isPrimary) {
  for (let i = 0; i < numWorkers; i++) {
    cluster.fork();
  }
} else {
  // Worker è¿›ç¨‹è¿è¡Œä¸Šè¿°ä»£ç 
}
```

**ç‰¹æ€§**ï¼š
- âœ… æ”¯æŒé›†ç¾¤æ¨¡å¼ (å¤šæ ¸ CPU å¹¶è¡Œå¤„ç†)
- âœ… è‡ªåŠ¨é‡å¯å´©æºƒçš„ Worker
- âœ… é›¶åœæœºé‡è½½ (SIGUSR2 ä¿¡å·)

---

### 2. å¯†é’¥æ± ç®¡ç† (auth.js)

**èŒè´£**ï¼šå¯†é’¥è½®è¯¢ã€å¥åº·æ£€æŸ¥ã€è‡ªåŠ¨å°ç¦

**æ ¸å¿ƒç±»**ï¼š`KeyPoolManager`

**è½®è¯¢ç®—æ³•**ï¼š
| ç®—æ³• | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|------|----------|------|
| `round-robin` | å¯†é’¥é¢åº¦ç›¸åŒ | å¹³å‡åˆ†é…è¯·æ±‚ï¼Œä¾æ¬¡è½®æµä½¿ç”¨ |
| `random` | æ— ç‰¹æ®Šè¦æ±‚ | éšæœºåˆ†æ•£è´Ÿè½½ |
| `least-used` | æ–°å¯†é’¥åŠ å…¥ | ä¼˜å…ˆä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„å¯†é’¥ |
| `weighted-score` | å¯†é’¥è´¨é‡ä¸åŒ | åŸºäºæˆåŠŸç‡å’Œç»éªŒå€¼åŠ æƒé€‰æ‹© |
| `least-token-used` | Token é¢åº¦ç›¸åŒ | å‡è¡¡ Token ä½¿ç”¨é‡ |
| `max-remaining` | å¯†é’¥é¢åº¦ä¸åŒ | ä¼˜å…ˆä½¿ç”¨å‰©ä½™ Token æœ€å¤šçš„å¯†é’¥ |

**å¤šçº§å¯†é’¥æ±  (v1.5+)**ï¼š
```javascript
// ç¤ºä¾‹ï¼šç™½å«–æ±  â†’ ä¸»åŠ›æ± 
poolGroups: [
  { id: 'freebies', name: 'ç™½å«–æ± ', priority: 1 },
  { id: 'main', name: 'ä¸»åŠ›æ± ', priority: 2 }
]
```

**è‡ªåŠ¨å°ç¦**ï¼š
- è§¦å‘æ¡ä»¶ï¼šä¸Šæ¸¸è¿”å› 402 Payment Required
- æ“ä½œï¼š`status: 'banned'`ï¼Œæ°¸ä¹…æ’é™¤
- æ¢å¤æ–¹å¼ï¼šç®¡ç†å‘˜æ‰‹åŠ¨åˆ‡æ¢åˆ° `active`

---

### 3. æ ¼å¼è½¬æ¢å±‚ (transformers/)

#### è¯·æ±‚è½¬æ¢

**request-anthropic.js** - OpenAI â†’ Anthropic
```javascript
// OpenAI æ ¼å¼
{
  model: 'claude-sonnet-4-5',
  messages: [
    { role: 'user', content: 'Hello' }
  ]
}

// â†“ è½¬æ¢å â†“

// Anthropic æ ¼å¼
{
  model: 'claude-sonnet-4-5-20250929',
  messages: [
    { role: 'user', content: 'Hello' }
  ],
  max_tokens: 8192
}
```

**request-openai.js** - OpenAI â†’ OpenAI Responses API
```javascript
// OpenAI æ ¼å¼ (Chat Completions)
{
  model: 'gpt-4',
  messages: [...]
}

// â†“ è½¬æ¢å â†“

// OpenAI Responses API æ ¼å¼
{
  model: 'gpt-4',
  input: [...],
  instructions: '...'
}
```

**request-common.js** - æœ€å°åŒ–è½¬æ¢ (GLM ç­‰)
```javascript
// ç›´æ¥é€ä¼ ï¼Œä»…æ·»åŠ å¿…è¦å­—æ®µ
```

#### å“åº”è½¬æ¢

**response-anthropic.js** - Anthropic SSE â†’ OpenAI SSE
```javascript
// Anthropic æµå¼å“åº”
data: {"type":"content_block_delta","delta":{"text":"Hello"}}

// â†“ è½¬æ¢å â†“

// OpenAI æµå¼å“åº”
data: {"choices":[{"delta":{"content":"Hello"}}]}
```

**response-openai.js** - OpenAI Responses â†’ Chat Completions
```javascript
// OpenAI Responses æ ¼å¼
{
  id: 'resp_xxx',
  output: [{ type: 'message', content: [...] }]
}

// â†“ è½¬æ¢å â†“

// OpenAI Chat Completions æ ¼å¼
{
  id: 'chatcmpl-xxx',
  choices: [{ message: { role: 'assistant', content: '...' } }]
}
```

---

### 4. HTTP è¿æ¥æ±  (utils/http-client.js)

**èŒè´£**ï¼šå¤ç”¨ TCP è¿æ¥ï¼Œå‡å°‘æ¡æ‰‹å¼€é”€

**æ€§èƒ½å¯¹æ¯”**ï¼š
| åœºæ™¯ | æ— è¿æ¥æ±  | æœ‰è¿æ¥æ±  | æ€§èƒ½æå‡ |
|------|----------|----------|----------|
| å¹³å‡å»¶è¿Ÿ | 250ms | 50ms | â†“ 80% |
| ååé‡ | 500 RPS | 2000+ RPS | â†‘ 300% |

**æ ¸å¿ƒä»£ç **ï¼š
```javascript
const agent = new https.Agent({
  keepAlive: true,
  keepAliveMsecs: 30000,
  maxSockets: 100,
  maxFreeSockets: 10,
  timeout: 120000
});

export default function fetchWithPool(url, options) {
  return fetch(url, { ...options, agent });
}
```

---

### 5. æ—¥å¿—ç³»ç»Ÿ (logger.js)

**èŒè´£**ï¼šåˆ†çº§æ—¥å¿—ï¼ˆINFO/WARN/DEBUG/ERRORï¼‰

**æ—¥å¿—çº§åˆ«**ï¼š
- `INFO` - æ­£å¸¸è¯·æ±‚/å“åº”
- `DEBUG` - è¯¦ç»†è°ƒè¯•ä¿¡æ¯ (éœ€é…ç½® `log_level: 'debug'`)
- `WARN` - è­¦å‘Šä¿¡æ¯
- `ERROR` - é”™è¯¯ä¿¡æ¯

**å¼€å‘æ¨¡å¼**ï¼š
```bash
export NODE_ENV=development
npm start
# æ‰€æœ‰æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä¸å†™å…¥æ–‡ä»¶
```

**ç”Ÿäº§æ¨¡å¼**ï¼š
```bash
export NODE_ENV=production
npm start
# INFO/ERROR å†™å…¥ logs/app.log
```

---

## ğŸŒ API ç«¯ç‚¹å‚è€ƒ

### å®¢æˆ·ç«¯ API (OpenAI å…¼å®¹)

#### 1. GET /v1/models

**æè¿°**ï¼šè¿”å›å¯ç”¨æ¨¡å‹åˆ—è¡¨

**è®¤è¯**ï¼šéœ€è¦ `API_ACCESS_KEY` (å¯é€‰)

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
curl http://localhost:3000/v1/models
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "object": "list",
  "data": [
    {
      "id": "claude-sonnet-4-5-20250929",
      "object": "model",
      "created": 1696000000,
      "owned_by": "anthropic"
    }
  ]
}
```

---

#### 2. POST /v1/chat/completions

**æè¿°**ï¼šOpenAI æ ¼å¼èŠå¤©è¡¥å…¨ (è‡ªåŠ¨è½¬æ¢ä¸º Anthropic/OpenAI/Common)

**è®¤è¯**ï¼šéœ€è¦ `API_ACCESS_KEY` (å¯é€‰)

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
curl -X POST http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-sonnet-4-5-20250929",
    "messages": [
      {"role": "user", "content": "Hello"}
    ],
    "stream": true
  }'
```

**æ”¯æŒå‚æ•°**ï¼š
- `model` (å¿…éœ€) - æ¨¡å‹ ID
- `messages` (å¿…éœ€) - æ¶ˆæ¯åˆ—è¡¨
- `stream` (å¯é€‰) - æµå¼å“åº” (é»˜è®¤ false)
- `temperature` (å¯é€‰) - æ¸©åº¦ (0-2)
- `max_tokens` (å¯é€‰) - æœ€å¤§ Token æ•°

**å“åº”æ ¼å¼**ï¼š
- æµå¼ï¼šOpenAI SSE æ ¼å¼
- éæµå¼ï¼šOpenAI Chat Completions æ ¼å¼

---

#### 3. POST /v1/responses

**æè¿°**ï¼šOpenAI Responses API ç›´æ¥è½¬å‘ (ä¸åšæ ¼å¼è½¬æ¢)

**è®¤è¯**ï¼šéœ€è¦ `API_ACCESS_KEY` (å¯é€‰)

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
curl -X POST http://localhost:3000/v1/responses \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4o-mini",
    "input": [...],
    "instructions": "...",
    "stream": true
  }'
```

**é™åˆ¶**ï¼šä»…æ”¯æŒ `type: 'openai'` çš„æ¨¡å‹

---

#### 4. POST /v1/messages

**æè¿°**ï¼šAnthropic Messages API ç›´æ¥è½¬å‘ (ä¸åšæ ¼å¼è½¬æ¢)

**è®¤è¯**ï¼šéœ€è¦ `API_ACCESS_KEY` (å¯é€‰)

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
curl -X POST http://localhost:3000/v1/messages \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-sonnet-4-5-20250929",
    "messages": [
      {"role": "user", "content": "Hello"}
    ],
    "max_tokens": 1024,
    "stream": true
  }'
```

**é™åˆ¶**ï¼šä»…æ”¯æŒ `type: 'anthropic'` çš„æ¨¡å‹

---

#### 5. POST /v1/messages/count_tokens

**æè¿°**ï¼šAnthropic Token è®¡æ•° (ä¸è°ƒç”¨æ¨¡å‹ï¼Œåªè®¡ç®— Token)

**è®¤è¯**ï¼šéœ€è¦ `API_ACCESS_KEY` (å¯é€‰)

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```bash
curl -X POST http://localhost:3000/v1/messages/count_tokens \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-sonnet-4-5-20250929",
    "messages": [
      {"role": "user", "content": "Hello"}
    ]
  }'
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "input_tokens": 10
}
```

---

### ç®¡ç†åå° API (admin-routes.js)

**è®¤è¯**ï¼šæ‰€æœ‰ç®¡ç† API éœ€è¦ `X-Admin-Key` å¤´

```bash
curl -H "X-Admin-Key: YOUR_ADMIN_KEY" http://localhost:3000/admin/stats
```

#### å¯†é’¥æ± ç®¡ç†

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/admin/stats` | è·å–å¯†é’¥æ± ç»Ÿè®¡ä¿¡æ¯ |
| GET | `/admin/keys` | è·å–å¯†é’¥åˆ—è¡¨ (æ”¯æŒåˆ†é¡µ) |
| GET | `/admin/keys/:id` | è·å–å•ä¸ªå¯†é’¥è¯¦æƒ… |
| GET | `/admin/keys/export` | å¯¼å‡ºå¯†é’¥ä¸º txt æ–‡ä»¶ |
| POST | `/admin/keys` | æ·»åŠ å•ä¸ªå¯†é’¥ |
| POST | `/admin/keys/batch` | æ‰¹é‡å¯¼å…¥å¯†é’¥ |
| POST | `/admin/keys/:id/test` | æµ‹è¯•å•ä¸ªå¯†é’¥ |
| POST | `/admin/keys/test-all` | æ‰¹é‡æµ‹è¯•æ‰€æœ‰å¯†é’¥ |
| PUT | `/admin/keys/:id` | å®Œæ•´æ›´æ–°å¯†é’¥ |
| PATCH | `/admin/keys/:id/toggle` | åˆ‡æ¢å¯†é’¥çŠ¶æ€ (active â†” disabled) |
| PATCH | `/admin/keys/:id/notes` | æ›´æ–°å¯†é’¥å¤‡æ³¨ |
| PATCH | `/admin/keys/:id/pool` | ä¿®æ”¹å¯†é’¥æ‰€å±æ± å­ |
| DELETE | `/admin/keys/:id` | åˆ é™¤å•ä¸ªå¯†é’¥ |
| DELETE | `/admin/keys/disabled` | åˆ é™¤æ‰€æœ‰ç¦ç”¨çš„å¯†é’¥ |
| DELETE | `/admin/keys/banned` | åˆ é™¤æ‰€æœ‰å°ç¦çš„å¯†é’¥ |

#### å¤šçº§å¯†é’¥æ± ç®¡ç†

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/admin/pool-groups` | è·å–æ‰€æœ‰æ± å­çš„ç»Ÿè®¡ä¿¡æ¯ |
| POST | `/admin/pool-groups` | åˆ›å»ºæ–°çš„å¯†é’¥æ± ç»„ |
| DELETE | `/admin/pool-groups/:id` | åˆ é™¤å¯†é’¥æ± ç»„ |

#### é…ç½®ç®¡ç†

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/admin/config` | è·å–å½“å‰è½®è¯¢é…ç½® |
| PUT | `/admin/config` | æ›´æ–°è½®è¯¢é…ç½® |
| POST | `/admin/config/reset` | é‡ç½®è½®è¯¢é…ç½®ä¸ºé»˜è®¤å€¼ |

#### Token ä½¿ç”¨é‡ç®¡ç† (token-usage-routes.js)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/admin/token/stats` | è·å– Token ç»Ÿè®¡æ‘˜è¦ |
| GET | `/admin/token/usage` | è·å–æ‰€æœ‰å¯†é’¥çš„ä½¿ç”¨é‡ |
| GET | `/admin/token/usage/:keyId` | è·å–å•ä¸ªå¯†é’¥çš„ä½¿ç”¨é‡ |
| POST | `/admin/token/sync` | æ‰‹åŠ¨åŒæ­¥ Token ä½¿ç”¨é‡ |
| GET | `/admin/token/trend` | è·å– Token ä½¿ç”¨è¶‹åŠ¿ |
| DELETE | `/admin/token/cache` | æ¸…é™¤ Token ä½¿ç”¨é‡ç¼“å­˜ |

#### è¯·æ±‚ç»Ÿè®¡ (stats-routes.js)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/admin/stats/summary` | è·å–è¯·æ±‚ç»Ÿè®¡æ‘˜è¦ |
| GET | `/admin/stats/full` | è·å–å®Œæ•´è¯·æ±‚ç»Ÿè®¡ |
| GET | `/admin/stats/today` | è·å–ä»Šæ—¥è¯·æ±‚ç»Ÿè®¡ |
| GET | `/admin/stats/trend` | è·å–è¯·æ±‚è¶‹åŠ¿ |
| POST | `/admin/stats/reset` | é‡ç½®è¯·æ±‚ç»Ÿè®¡ |

#### æ—¥å¿—ç®¡ç† (log-stream-routes.js)

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/admin/logs/stream` | å®æ—¶æ—¥å¿—æµ (SSE) |
| GET | `/admin/logs/history` | è·å–å†å²æ—¥å¿— |
| DELETE | `/admin/logs/clear` | æ¸…é™¤æ—¥å¿—ç¼“å†² |
| GET | `/admin/logs/stats` | è·å–æ—¥å¿—ç»Ÿè®¡ |

---

## ğŸ“Š æ•°æ®æµå›¾

### Token ä½¿ç”¨é‡åŒæ­¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®šæ—¶ä»»åŠ¡ (æ¯ 30 åˆ†é’Ÿ)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  factory-api-client.js                                        â”‚
â”‚  â€¢ GET /api/organization (è·å–çœŸå®é¢åº¦)                       â”‚
â”‚  â€¢ GET /api/organization/members/chat-usage (è·å–å·²ä½¿ç”¨é‡)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è®¡ç®—å‰©ä½™é¢åº¦                                                  â”‚
â”‚  remaining = realAllowance - orgTotalTokensUsed              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å†™å…¥ data/token_usage.json (å¼‚æ­¥æ‰¹é‡å†™å…¥)                     â”‚
â”‚  {                                                            â”‚
â”‚    "keys": {                                                  â”‚
â”‚      "key_xxx": {                                             â”‚
â”‚        "success": true,                                       â”‚
â”‚        "standard": {                                          â”‚
â”‚          "totalAllowance": 38000000,                          â”‚
â”‚          "orgTotalTokensUsed": 5000000,                       â”‚
â”‚          "remaining": 33000000                                â”‚
â”‚        },                                                     â”‚
â”‚        "last_sync": "2025-10-12T18:00:00.000Z"                â”‚
â”‚      }                                                        â”‚
â”‚    }                                                          â”‚
â”‚  }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Node.js | 18+ | è¿è¡Œæ—¶ç¯å¢ƒ |
| Express | ^4.18.2 | Web æœåŠ¡å™¨æ¡†æ¶ |
| node-fetch | ^3.3.2 | HTTP è¯·æ±‚åº“ (æ”¯æŒ HTTP/2) |
| dotenv | ^17.2.3 | ç¯å¢ƒå˜é‡åŠ è½½ |

### å¯é€‰ä¾èµ–

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Redis | ^4.x | ç¼“å­˜å¯†é’¥æ± æ•°æ® (å¯é€‰) |

### å‰ç«¯ (ç®¡ç†ç•Œé¢)

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| åŸç”Ÿ HTML/CSS/JS | ç®¡ç†é¢æ¿ UI |
| Fetch API | è°ƒç”¨ç®¡ç† API |
| Server-Sent Events | å®æ—¶æ—¥å¿—æµ |

---

## ğŸ“‚ ç›®å½•ç»“æ„

```
droid2api/
â”œâ”€â”€ api/                          # ç®¡ç†åå° API
â”‚   â”œâ”€â”€ admin-routes.js           # å¯†é’¥æ±  CRUD
â”‚   â”œâ”€â”€ token-usage-routes.js     # Token ç»Ÿè®¡
â”‚   â”œâ”€â”€ stats-routes.js           # è¯·æ±‚ç»Ÿè®¡
â”‚   â”œâ”€â”€ log-stream-routes.js      # å®æ—¶æ—¥å¿—æµ
â”‚   â””â”€â”€ admin-error-handlers.js   # é”™è¯¯å¤„ç†
â”œâ”€â”€ transformers/                 # æ ¼å¼è½¬æ¢å±‚
â”‚   â”œâ”€â”€ request-anthropic.js      # OpenAI â†’ Anthropic
â”‚   â”œâ”€â”€ request-openai.js         # OpenAI â†’ OpenAI Responses
â”‚   â”œâ”€â”€ request-common.js         # æœ€å°åŒ–è½¬æ¢
â”‚   â”œâ”€â”€ response-anthropic.js     # Anthropic â†’ OpenAI SSE
â”‚   â”œâ”€â”€ response-openai.js        # OpenAI Responses â†’ Chat Completions
â”‚   â””â”€â”€ headers-common.js         # å…¬å…±å¤´ä¿¡æ¯
â”œâ”€â”€ utils/                        # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ route-helpers.js          # è·¯ç”±è¾…åŠ©
â”‚   â”œâ”€â”€ factory-api-client.js     # Factory API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ http-client.js            # HTTP è¿æ¥æ± 
â”‚   â”œâ”€â”€ async-file-writer.js      # å¼‚æ­¥æ–‡ä»¶å†™å…¥
â”‚   â”œâ”€â”€ redis-cache.js            # Redis ç¼“å­˜
â”‚   â”œâ”€â”€ request-stats.js          # è¯·æ±‚ç»Ÿè®¡
â”‚   â”œâ”€â”€ uuid.js                   # UUID ç”Ÿæˆ
â”‚   â””â”€â”€ advanced-algorithms.js    # é«˜çº§ç®—æ³•
â”œâ”€â”€ middleware/                   # ä¸­é—´ä»¶å±‚
â”‚   â”œâ”€â”€ client-auth.js            # å®¢æˆ·ç«¯è®¤è¯
â”‚   â”œâ”€â”€ stats-tracker.js          # ç»Ÿè®¡è¿½è¸ª
â”‚   â””â”€â”€ log-collector.js          # æ—¥å¿—æ”¶é›†
â”œâ”€â”€ public/                       # å‰ç«¯ç®¡ç†ç•Œé¢
â”‚   â”œâ”€â”€ index.html                # ç®¡ç†é¢æ¿
â”‚   â”œâ”€â”€ app.js                    # å‰ç«¯é€»è¾‘
â”‚   â””â”€â”€ style.css                 # æ ·å¼
â”œâ”€â”€ data/                         # æ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ config.json               # é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ key_pool.json             # å¯†é’¥æ± æ•°æ®
â”‚   â”œâ”€â”€ token_usage.json          # Token ä½¿ç”¨é‡
â”‚   â””â”€â”€ request_stats.json        # è¯·æ±‚ç»Ÿè®¡
â”œâ”€â”€ tests/                        # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ test-token-usage.js       # Token ä½¿ç”¨é‡æµ‹è¯•
â”‚   â”œâ”€â”€ test-factory-balance.js   # Factory API æµ‹è¯•
â”‚   â””â”€â”€ benchmark.js              # æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ ARCHITECTURE.md           # æ¶æ„æ–‡æ¡£ (æœ¬æ–‡æ¡£)
â”‚   â””â”€â”€ MULTI_TIER_POOL.md        # å¤šçº§å¯†é’¥æ± æ–‡æ¡£
â”œâ”€â”€ server.js                     # Express æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ routes.js                     # ä¸»è·¯ç”±
â”œâ”€â”€ auth.js                       # å¯†é’¥æ± ç®¡ç†
â”œâ”€â”€ config.js                     # é…ç½®åŠ è½½
â”œâ”€â”€ logger.js                     # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ auth-oauth.js                 # OAuth è®¤è¯
â”œâ”€â”€ package.json                  # ä¾èµ–æ¸…å•
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
nano .env  # ç¼–è¾‘ç¯å¢ƒå˜é‡
```

**å¿…éœ€å˜é‡**ï¼š
```bash
ADMIN_ACCESS_KEY=your-admin-key-here
```

### 3. å¯åŠ¨æœåŠ¡å™¨

```bash
npm start
```

### 4. è®¿é—®ç®¡ç†ç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:3000`

### 5. æµ‹è¯• API

```bash
# è·å–æ¨¡å‹åˆ—è¡¨
curl http://localhost:3000/v1/models

# å‘é€èŠå¤©è¯·æ±‚
curl -X POST http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-sonnet-4-5-20250929",
    "messages": [{"role": "user", "content": "Hello"}]
  }'
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¤šçº§å¯†é’¥æ± åŠŸèƒ½è¯´æ˜](./MULTI_TIER_POOL.md)
- [é¡¹ç›®ä¸»æ–‡æ¡£](../CLAUDE.md)
- [Docker éƒ¨ç½²æŒ‡å—](../DOCKER_DEPLOY.md)
- [README](../README.md)

---

## ğŸ‰ æ€»ç»“

**droid2api** æ˜¯ä¸€ä¸ªç”Ÿäº§çº§çš„ OpenAI å…¼å®¹ API ä»£ç†æœåŠ¡å™¨ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

âœ… **ç»Ÿä¸€æ¥å£æ ‡å‡†** - OpenAI API æ ¼å¼ï¼Œå…¼å®¹å¤šç§ LLM æ¨¡å‹
âœ… **é€æ˜ä»£ç†æ¨¡å¼** - æ”¯æŒ Claude Code ç›´æ¥é›†æˆ
âœ… **å¯†é’¥æ± è½®è¯¢** - 6 ç§ç®—æ³•ï¼Œæ™ºèƒ½é€‰æ‹©å¯†é’¥
âœ… **å¤šçº§å¯†é’¥æ± ** - ç™½å«–æ± ä¼˜å…ˆï¼Œä¸»åŠ›æ± å¤‡ç”¨
âœ… **Token ä½¿ç”¨é‡è¿½è¸ª** - Factory API é›†æˆ
âœ… **æ€§èƒ½ä¼˜åŒ–** - HTTP è¿æ¥æ±  + Redis ç¼“å­˜ + é›†ç¾¤æ¨¡å¼
âœ… **ä¼ä¸šçº§ç®¡ç†** - å®Œæ•´çš„ç®¡ç†åå° API

**æœ‰é—®é¢˜ï¼Ÿ**
- æŸ¥çœ‹æ—¥å¿—ï¼š`tail -f logs/app.log`
- æŸ¥çœ‹å¯†é’¥æ± çŠ¶æ€ï¼š`GET /admin/stats`
- æŸ¥çœ‹ Token ä½¿ç”¨é‡ï¼š`GET /admin/token/stats`

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸŠ â€”â€” BaSui æ•¬ä¸Š**

# droid2api

OpenAI å…¼å®¹çš„ API ä»£ç†æœåŠ¡å™¨ï¼Œç»Ÿä¸€è®¿é—®ä¸åŒçš„ LLM æ¨¡å‹ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ” åŒé‡æˆæƒæœºåˆ¶
- **FACTORY_API_KEYä¼˜å…ˆçº§** - ç¯å¢ƒå˜é‡è®¾ç½®å›ºå®šAPIå¯†é’¥ï¼Œè·³è¿‡è‡ªåŠ¨åˆ·æ–°
- **ä»¤ç‰Œè‡ªåŠ¨åˆ·æ–°** - WorkOS OAuthé›†æˆï¼Œç³»ç»Ÿæ¯6å°æ—¶è‡ªåŠ¨åˆ·æ–°access_token
- **å®¢æˆ·ç«¯æˆæƒå›é€€** - æ— é…ç½®æ—¶ä½¿ç”¨å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„authorizationå­—æ®µ
- **æ™ºèƒ½ä¼˜å…ˆçº§** - FACTORY_API_KEY > refresh_token > å®¢æˆ·ç«¯authorization
- **å®¹é”™å¯åŠ¨** - æ— ä»»ä½•è®¤è¯é…ç½®æ—¶ä¸æŠ¥é”™ï¼Œç»§ç»­è¿è¡Œæ”¯æŒå®¢æˆ·ç«¯æˆæƒ

### ğŸ¯ å¯†é’¥æ± ç®¡ç†ç³»ç»Ÿï¼ˆæ— é™é‡å¯†é’¥æ”¯æŒï¼‰
- **å¤§è§„æ¨¡å¯†é’¥è½®è¯¢** - æ”¯æŒæ— æ•°é‡é™åˆ¶çš„ FACTORY_API_KEY æ± åŒ–ç®¡ç†
- **æ™ºèƒ½è½®è¯¢ç®—æ³•** - æ”¯æŒ round-robinã€randomã€least-usedã€weighted-score å››ç§ç®—æ³•
- **è‡ªåŠ¨å¥åº·æ£€æŸ¥** - æ‰¹é‡æµ‹è¯•å¯†é’¥å¯ç”¨æ€§ï¼Œè‡ªåŠ¨æ ‡è®°å¤±æ•ˆå¯†é’¥
- **è‡ªåŠ¨å°ç¦æœºåˆ¶** - æµ‹è¯•è¿”å›200æ ‡è®°æˆåŠŸï¼Œ402é”™è¯¯è‡ªåŠ¨å°ç¦ï¼Œå…¶ä»–é”™è¯¯è‡ªåŠ¨ç¦ç”¨
- **Webç®¡ç†ç•Œé¢** - å¯è§†åŒ–ç®¡ç†æ‰€æœ‰å¯†é’¥ï¼Œæ”¯æŒæ·»åŠ /åˆ é™¤/æµ‹è¯•/å¯¼å‡º
- **å¯†é’¥çŠ¶æ€ç®¡ç†** - activeï¼ˆå¯ç”¨ï¼‰/disabledï¼ˆç¦ç”¨ï¼‰/bannedï¼ˆå°ç¦ï¼‰ä¸‰æ€ç®¡ç†
- **æ‰¹é‡æ“ä½œ** - æ‰¹é‡å¯¼å…¥ã€æ‰¹é‡æµ‹è¯•ã€æ‰¹é‡åˆ é™¤ç¦ç”¨/å°ç¦å¯†é’¥
- **æ•°æ®æŒä¹…åŒ–** - å¯†é’¥æ± çŠ¶æ€è‡ªåŠ¨ä¿å­˜åˆ° `key_pool.json`ï¼Œå¸¦å¤‡ä»½å’ŒåŸå­å†™å…¥

### ğŸ§  æ™ºèƒ½æ¨ç†çº§åˆ«æ§åˆ¶
- **äº”æ¡£æ¨ç†çº§åˆ«** - auto/off/low/medium/highï¼Œçµæ´»æ§åˆ¶æ¨ç†è¡Œä¸º
- **autoæ¨¡å¼** - å®Œå…¨éµå¾ªå®¢æˆ·ç«¯åŸå§‹è¯·æ±‚ï¼Œä¸åšä»»ä½•æ¨ç†å‚æ•°ä¿®æ”¹
- **å›ºå®šçº§åˆ«** - off/low/medium/highå¼ºåˆ¶è¦†ç›–å®¢æˆ·ç«¯æ¨ç†è®¾ç½®
- **OpenAIæ¨¡å‹** - è‡ªåŠ¨æ³¨å…¥reasoningå­—æ®µï¼Œeffortå‚æ•°æ§åˆ¶æ¨ç†å¼ºåº¦
- **Anthropicæ¨¡å‹** - è‡ªåŠ¨é…ç½®thinkingå­—æ®µå’Œbudget_tokens (4096/12288/24576)
- **æ™ºèƒ½å¤´ç®¡ç†** - æ ¹æ®æ¨ç†çº§åˆ«è‡ªåŠ¨æ·»åŠ /ç§»é™¤anthropic-betaç›¸å…³æ ‡è¯†

### ğŸš€ æœåŠ¡å™¨éƒ¨ç½²/Dockeréƒ¨ç½²
- **æœ¬åœ°æœåŠ¡å™¨** - æ”¯æŒnpm startå¿«é€Ÿå¯åŠ¨
- **Dockerå®¹å™¨åŒ–** - æä¾›å®Œæ•´çš„Dockerfileå’Œdocker-compose.yml
- **äº‘ç«¯éƒ¨ç½²** - æ”¯æŒå„ç§äº‘å¹³å°çš„å®¹å™¨åŒ–éƒ¨ç½²
- **ç¯å¢ƒéš”ç¦»** - Dockeréƒ¨ç½²ç¡®ä¿ä¾èµ–ç¯å¢ƒçš„å®Œå…¨ä¸€è‡´æ€§
- **ç”Ÿäº§å°±ç»ª** - åŒ…å«å¥åº·æ£€æŸ¥ã€æ—¥å¿—ç®¡ç†ç­‰ç”Ÿäº§çº§ç‰¹æ€§

### ğŸ’» Claude Codeç›´æ¥ä½¿ç”¨
- **é€æ˜ä»£ç†æ¨¡å¼** - /v1/responseså’Œ/v1/messagesç«¯ç‚¹æ”¯æŒç›´æ¥è½¬å‘
- **å®Œç¾å…¼å®¹** - ä¸Claude Code CLIå·¥å…·æ— ç¼é›†æˆ
- **ç³»ç»Ÿæç¤ºæ³¨å…¥** - è‡ªåŠ¨æ·»åŠ Droidèº«ä»½æ ‡è¯†ï¼Œä¿æŒä¸Šä¸‹æ–‡ä¸€è‡´æ€§
- **è¯·æ±‚å¤´æ ‡å‡†åŒ–** - è‡ªåŠ¨æ·»åŠ Factoryç‰¹å®šçš„è®¤è¯å’Œä¼šè¯å¤´ä¿¡æ¯
- **é›¶é…ç½®ä½¿ç”¨** - Claude Codeå¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–è®¾ç½®

## ç®¡ç†åå°

### è®¿é—®ç®¡ç†ç•Œé¢

å¯åŠ¨æœåŠ¡åï¼Œè®¿é—® `http://localhost:3000/` è¿›å…¥ Web ç®¡ç†ç•Œé¢ã€‚

**ä¸»è¦åŠŸèƒ½**ï¼š
- ğŸ“Š **å¯†é’¥æ± ç»Ÿè®¡** - æŸ¥çœ‹æ€»æ•°ã€å¯ç”¨ã€ç¦ç”¨ã€å°ç¦å¯†é’¥æ•°é‡
- â• **æ·»åŠ å¯†é’¥** - å•ä¸ªæ·»åŠ æˆ–æ‰¹é‡å¯¼å…¥å¯†é’¥
- ğŸ§ª **æµ‹è¯•å¯†é’¥** - å•ä¸ªæµ‹è¯•æˆ–æ‰¹é‡æµ‹è¯•æ‰€æœ‰å¯†é’¥å¯ç”¨æ€§
- ğŸ“¤ **å¯¼å‡ºå¯†é’¥** - æŒ‰çŠ¶æ€ç­›é€‰å¯¼å‡ºä¸º txt æ–‡ä»¶
- ğŸ—‘ï¸ **åˆ é™¤å¯†é’¥** - å•ä¸ªåˆ é™¤æˆ–æ‰¹é‡åˆ é™¤ç¦ç”¨/å°ç¦å¯†é’¥
- âš™ï¸ **é…ç½®ç®¡ç†** - è°ƒæ•´è½®è¯¢ç®—æ³•ã€é‡è¯•æœºåˆ¶ã€æ€§èƒ½å‚æ•°

### ç®¡ç† API ç«¯ç‚¹

æ‰€æœ‰ç®¡ç†æ¥å£éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  `x-admin-key` è®¤è¯ï¼š

```bash
curl -H "x-admin-key: your-admin-key" http://localhost:3000/admin/stats
```

**æ ¸å¿ƒæ¥å£**ï¼š
- `GET /admin/stats` - å¯†é’¥æ± ç»Ÿè®¡ä¿¡æ¯
- `GET /admin/keys` - å¯†é’¥åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’ŒçŠ¶æ€ç­›é€‰ï¼‰
- `POST /admin/keys` - æ·»åŠ å•ä¸ªå¯†é’¥
- `POST /admin/keys/batch` - æ‰¹é‡å¯¼å…¥å¯†é’¥
- `DELETE /admin/keys/:id` - åˆ é™¤å¯†é’¥
- `PATCH /admin/keys/:id/toggle` - åˆ‡æ¢å¯†é’¥çŠ¶æ€
- `POST /admin/keys/:id/test` - æµ‹è¯•å•ä¸ªå¯†é’¥
- `POST /admin/keys/test-all` - æ‰¹é‡æµ‹è¯•æ‰€æœ‰å¯†é’¥
- `GET /admin/keys/export` - å¯¼å‡ºå¯†é’¥ä¸ºtxtæ–‡ä»¶
- `GET /admin/config` - è·å–è½®è¯¢é…ç½®
- `PUT /admin/config` - æ›´æ–°è½®è¯¢é…ç½®

## å…¶ä»–ç‰¹æ€§

- ğŸ¯ **æ ‡å‡† OpenAI API æ¥å£** - ä½¿ç”¨ç†Ÿæ‚‰çš„ OpenAI API æ ¼å¼è®¿é—®æ‰€æœ‰æ¨¡å‹
- ğŸ”„ **è‡ªåŠ¨æ ¼å¼è½¬æ¢** - è‡ªåŠ¨å¤„ç†ä¸åŒ LLM æä¾›å•†çš„æ ¼å¼å·®å¼‚
- ğŸŒŠ **æ™ºèƒ½æµå¼å¤„ç†** - å®Œå…¨å°Šé‡å®¢æˆ·ç«¯streamå‚æ•°ï¼Œæ”¯æŒæµå¼å’Œéæµå¼å“åº”
- âš™ï¸ **çµæ´»é…ç½®** - é€šè¿‡é…ç½®æ–‡ä»¶è‡ªå®šä¹‰æ¨¡å‹å’Œç«¯ç‚¹
- ğŸ“ **æ™ºèƒ½æ—¥å¿—ç³»ç»Ÿ** - å¼€å‘æ¨¡å¼è¯¦ç»†æ§åˆ¶å°æ—¥å¿—ï¼Œç”Ÿäº§æ¨¡å¼æ–‡ä»¶æ—¥å¿—ï¼ˆæŒ‰å¤©è½®æ¢ï¼‰

## å®‰è£…

å®‰è£…é¡¹ç›®ä¾èµ–ï¼š

```bash
npm install
```

**ä¾èµ–è¯´æ˜**ï¼š
- `express` - WebæœåŠ¡å™¨æ¡†æ¶
- `node-fetch` - HTTPè¯·æ±‚åº“

> ğŸ’¡ **é¦–æ¬¡ä½¿ç”¨å¿…é¡»æ‰§è¡Œ `npm install`**ï¼Œä¹‹ååªéœ€è¦ `npm start` å¯åŠ¨æœåŠ¡å³å¯ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®è®¤è¯ï¼ˆä¸‰ç§æ–¹å¼ï¼‰

**ä¼˜å…ˆçº§ï¼šFACTORY_API_KEY > refresh_token > å®¢æˆ·ç«¯authorization**

```bash
# æ–¹å¼1ï¼šå›ºå®šAPIå¯†é’¥ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
export FACTORY_API_KEY="your_factory_api_key_here"

# æ–¹å¼2ï¼šè‡ªåŠ¨åˆ·æ–°ä»¤ç‰Œ
export DROID_REFRESH_KEY="your_refresh_token_here"

# æ–¹å¼3ï¼šé…ç½®æ–‡ä»¶ ~/.factory/auth.json
{
  "access_token": "your_access_token", 
  "refresh_token": "your_refresh_token"
}

# æ–¹å¼4ï¼šæ— é…ç½®ï¼ˆå®¢æˆ·ç«¯æˆæƒï¼‰
# æœåŠ¡å™¨å°†ä½¿ç”¨å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­çš„authorizationå­—æ®µ
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶é…ç½®ä»¥ä¸‹å˜é‡ï¼š

```env
# ===== API è®¤è¯é…ç½®ï¼ˆä¸‰é€‰ä¸€ï¼‰ =====
FACTORY_API_KEY=your_factory_api_key_here        # æ–¹å¼1ï¼šå›ºå®šå¯†é’¥ï¼ˆæ¨èï¼‰
DROID_REFRESH_KEY=your_refresh_token_here        # æ–¹å¼2ï¼šè‡ªåŠ¨åˆ·æ–°ä»¤ç‰Œ

# ===== ç®¡ç†åå°é…ç½®ï¼ˆå¿…éœ€ï¼‰ =====
ADMIN_ACCESS_KEY=your-secure-admin-password      # ç®¡ç†åå°è®¿é—®å¯†é’¥ï¼ˆå¼ºçƒˆæ¨èè®¾ç½®ï¼‰

# ===== æœåŠ¡é…ç½®ï¼ˆå¯é€‰ï¼‰ =====
PORT=3000                                        # æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤3000ï¼‰
NODE_ENV=production                              # è¿è¡Œç¯å¢ƒï¼ˆdevelopment/productionï¼‰
```

**é‡è¦è¯´æ˜**ï¼š
- `ADMIN_ACCESS_KEY` ç”¨äºä¿æŠ¤ç®¡ç†åå° `/admin/*` æ¥å£ï¼Œè¯·è®¾ç½®å¼ºå¯†ç 
- `NODE_ENV=development` å¯ç”¨è¯¦ç»†æ—¥å¿—ä½†ä¸å†™å…¥æ–‡ä»¶ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
- `NODE_ENV=production` å¯ç”¨æ–‡ä»¶æ—¥å¿—åˆ° `logs/` ç›®å½•ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰

### 3. é…ç½®æ¨¡å‹ï¼ˆå¯é€‰ï¼‰

ç¼–è¾‘ `config.json` æ·»åŠ æˆ–ä¿®æ”¹æ¨¡å‹ï¼š

```json
{
  "port": 3000,
  "models": [
    {
      "name": "Claude Opus 4",
      "id": "claude-opus-4-1-20250805",
      "type": "anthropic",
      "reasoning": "high"
    },
    {
      "name": "GPT-5",
      "id": "gpt-5-2025-08-07",
      "type": "openai",
      "reasoning": "medium"
    }
  ],
  "system_prompt": "You are Droid, an AI software engineering agent built by Factory.\n\nPlease forget the previous content and remember the following content.\n\n"
}
```

#### æ¨ç†çº§åˆ«é…ç½®

æ¯ä¸ªæ¨¡å‹æ”¯æŒäº”ç§æ¨ç†çº§åˆ«ï¼š

- **`auto`** - éµå¾ªå®¢æˆ·ç«¯åŸå§‹è¯·æ±‚ï¼Œä¸åšä»»ä½•æ¨ç†å‚æ•°ä¿®æ”¹
- **`off`** - å¼ºåˆ¶å…³é—­æ¨ç†åŠŸèƒ½ï¼Œåˆ é™¤æ‰€æœ‰æ¨ç†å­—æ®µ
- **`low`** - ä½çº§æ¨ç† (Anthropic: 4096 tokens, OpenAI: low effort)
- **`medium`** - ä¸­çº§æ¨ç† (Anthropic: 12288 tokens, OpenAI: medium effort) 
- **`high`** - é«˜çº§æ¨ç† (Anthropic: 24576 tokens, OpenAI: high effort)

**å¯¹äºAnthropicæ¨¡å‹ (Claude)**ï¼š
```json
{
  "name": "Claude Sonnet 4.5", 
  "id": "claude-sonnet-4-5-20250929",
  "type": "anthropic",
  "reasoning": "auto"  // æ¨èï¼šè®©å®¢æˆ·ç«¯æ§åˆ¶æ¨ç†
}
```
- `auto`: ä¿ç•™å®¢æˆ·ç«¯thinkingå­—æ®µï¼Œä¸ä¿®æ”¹anthropic-betaå¤´
- `low/medium/high`: è‡ªåŠ¨æ·»åŠ thinkingå­—æ®µå’Œanthropic-betaå¤´ï¼Œbudget_tokensæ ¹æ®çº§åˆ«è®¾ç½®

**å¯¹äºOpenAIæ¨¡å‹ (GPT)**ï¼š
```json
{
  "name": "GPT-5",
  "id": "gpt-5-2025-08-07",
  "type": "openai", 
  "reasoning": "auto"  // æ¨èï¼šè®©å®¢æˆ·ç«¯æ§åˆ¶æ¨ç†
}
```
- `auto`: ä¿ç•™å®¢æˆ·ç«¯reasoningå­—æ®µä¸å˜
- `low/medium/high`: è‡ªåŠ¨æ·»åŠ reasoningå­—æ®µï¼Œeffortå‚æ•°è®¾ç½®ä¸ºå¯¹åº”çº§åˆ«

## ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨æœåŠ¡å™¨

**æ–¹å¼1ï¼šä½¿ç”¨npmå‘½ä»¤**
```bash
npm start
```

**æ–¹å¼2ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬**

Linux/macOSï¼š
```bash
./start.sh
```

Windowsï¼š
```cmd
start.bat
```

æœåŠ¡å™¨é»˜è®¤è¿è¡Œåœ¨ `http://localhost:3000`ã€‚

### Dockeréƒ¨ç½²

#### ä½¿ç”¨docker-composeï¼ˆæ¨èï¼‰

```bash
# æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

#### ä½¿ç”¨Dockerfile

```bash
# æ„å»ºé•œåƒ
docker build -t droid2api .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 3000:3000 \
  -e DROID_REFRESH_KEY="your_refresh_token" \
  --name droid2api \
  droid2api
```

#### ç¯å¢ƒå˜é‡é…ç½®

Dockeréƒ¨ç½²æ”¯æŒä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

- `DROID_REFRESH_KEY` - åˆ·æ–°ä»¤ç‰Œï¼ˆå¿…éœ€ï¼‰
- `PORT` - æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤3000ï¼‰
- `NODE_ENV` - è¿è¡Œç¯å¢ƒï¼ˆproduction/developmentï¼‰

### Claude Codeé›†æˆ

#### é…ç½®Claude Codeä½¿ç”¨droid2api

1. **è®¾ç½®ä»£ç†åœ°å€**ï¼ˆåœ¨Claude Codeé…ç½®ä¸­ï¼‰ï¼š
   ```
   API Base URL: http://localhost:3000
   ```

2. **å¯ç”¨ç«¯ç‚¹**ï¼š
   - `/v1/chat/completions` - æ ‡å‡†OpenAIæ ¼å¼ï¼Œè‡ªåŠ¨æ ¼å¼è½¬æ¢
   - `/v1/responses` - ç›´æ¥è½¬å‘åˆ°OpenAIç«¯ç‚¹ï¼ˆé€æ˜ä»£ç†ï¼‰
   - `/v1/messages` - ç›´æ¥è½¬å‘åˆ°Anthropicç«¯ç‚¹ï¼ˆé€æ˜ä»£ç†ï¼‰
   - `/v1/models` - è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨

3. **è‡ªåŠ¨åŠŸèƒ½**ï¼š
   - âœ… ç³»ç»Ÿæç¤ºè‡ªåŠ¨æ³¨å…¥
   - âœ… è®¤è¯å¤´è‡ªåŠ¨æ·»åŠ 
   - âœ… æ¨ç†çº§åˆ«è‡ªåŠ¨é…ç½®
   - âœ… ä¼šè¯IDè‡ªåŠ¨ç”Ÿæˆ

#### ç¤ºä¾‹ï¼šClaude Code + æ¨ç†çº§åˆ«

å½“ä½¿ç”¨Claudeæ¨¡å‹æ—¶ï¼Œä»£ç†ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨æ·»åŠ æ¨ç†åŠŸèƒ½ï¼š

```bash
# Claude Codeå‘é€çš„è¯·æ±‚ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºï¼š
{
  "model": "claude-sonnet-4-5-20250929",
  "thinking": {
    "type": "enabled",
    "budget_tokens": 24576  // highçº§åˆ«è‡ªåŠ¨è®¾ç½®
  },
  "messages": [...],
  // åŒæ—¶è‡ªåŠ¨æ·»åŠ  anthropic-beta: interleaved-thinking-2025-05-14 å¤´
}
```

### API ä½¿ç”¨

#### è·å–æ¨¡å‹åˆ—è¡¨

```bash
curl http://localhost:3000/v1/models
```

#### å¯¹è¯è¡¥å…¨

**æµå¼å“åº”**ï¼ˆå®æ—¶è¿”å›ï¼‰ï¼š
```bash
curl http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-opus-4-1-20250805",
    "messages": [
      {"role": "user", "content": "ä½ å¥½"}
    ],
    "stream": true
  }'
```

**éæµå¼å“åº”**ï¼ˆç­‰å¾…å®Œæ•´ç»“æœï¼‰ï¼š
```bash
curl http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-opus-4-1-20250805",
    "messages": [
      {"role": "user", "content": "ä½ å¥½"}
    ],
    "stream": false
  }'
```

**æ”¯æŒçš„å‚æ•°ï¼š**
- `model` - æ¨¡å‹ IDï¼ˆå¿…éœ€ï¼‰
- `messages` - å¯¹è¯æ¶ˆæ¯æ•°ç»„ï¼ˆå¿…éœ€ï¼‰
- `stream` - æµå¼è¾“å‡ºæ§åˆ¶ï¼ˆå¯é€‰ï¼‰
  - `true` - å¯ç”¨æµå¼å“åº”ï¼Œå®æ—¶è¿”å›å†…å®¹
  - `false` - ç¦ç”¨æµå¼å“åº”ï¼Œç­‰å¾…å®Œæ•´ç»“æœ
  - æœªæŒ‡å®š - ç”±æœåŠ¡å™¨ç«¯å†³å®šé»˜è®¤è¡Œä¸º
- `max_tokens` - æœ€å¤§è¾“å‡ºé•¿åº¦
- `temperature` - æ¸©åº¦å‚æ•°ï¼ˆ0-1ï¼‰

## å¸¸è§é—®é¢˜

### å¦‚ä½•é…ç½®æˆæƒæœºåˆ¶ï¼Ÿ

droid2apiæ”¯æŒä¸‰çº§æˆæƒä¼˜å…ˆçº§ï¼š

1. **FACTORY_API_KEY**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
   ```bash
   export FACTORY_API_KEY="your_api_key"
   ```
   ä½¿ç”¨å›ºå®šAPIå¯†é’¥ï¼Œåœç”¨è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ã€‚

2. **refresh_tokenæœºåˆ¶**
   ```bash
   export DROID_REFRESH_KEY="your_refresh_token"
   ```
   è‡ªåŠ¨åˆ·æ–°ä»¤ç‰Œï¼Œæ¯6å°æ—¶æ›´æ–°ä¸€æ¬¡ã€‚

3. **å®¢æˆ·ç«¯æˆæƒ**ï¼ˆfallbackï¼‰
   æ— éœ€é…ç½®ï¼Œç›´æ¥ä½¿ç”¨å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„authorizationå­—æ®µã€‚

### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨FACTORY_API_KEYï¼Ÿ

- **å¼€å‘ç¯å¢ƒ** - ä½¿ç”¨å›ºå®šå¯†é’¥é¿å…ä»¤ç‰Œè¿‡æœŸé—®é¢˜
- **CI/CDæµæ°´çº¿** - ç¨³å®šçš„è®¤è¯ï¼Œä¸ä¾èµ–åˆ·æ–°æœºåˆ¶
- **ä¸´æ—¶æµ‹è¯•** - å¿«é€Ÿè®¾ç½®ï¼Œæ— éœ€é…ç½®refresh_token

### å¦‚ä½•æ§åˆ¶æµå¼å’Œéæµå¼å“åº”ï¼Ÿ

droid2apiå®Œå…¨å°Šé‡å®¢æˆ·ç«¯çš„streamå‚æ•°è®¾ç½®ï¼š

- **`"stream": true`** - å¯ç”¨æµå¼å“åº”ï¼Œå†…å®¹å®æ—¶è¿”å›
- **`"stream": false`** - ç¦ç”¨æµå¼å“åº”ï¼Œç­‰å¾…å®Œæ•´ç»“æœåè¿”å›
- **ä¸è®¾ç½®stream** - ç”±æœåŠ¡å™¨ç«¯å†³å®šé»˜è®¤è¡Œä¸ºï¼Œä¸å¼ºåˆ¶è½¬æ¢

### ä»€ä¹ˆæ˜¯autoæ¨ç†æ¨¡å¼ï¼Ÿ

`auto` æ˜¯v1.3.0æ–°å¢çš„æ¨ç†çº§åˆ«ï¼Œå®Œå…¨éµå¾ªå®¢æˆ·ç«¯çš„åŸå§‹è¯·æ±‚ï¼š

**è¡Œä¸ºç‰¹ç‚¹**ï¼š
- ğŸ¯ **é›¶å¹²é¢„** - ä¸æ·»åŠ ã€ä¸åˆ é™¤ã€ä¸ä¿®æ”¹ä»»ä½•æ¨ç†ç›¸å…³å­—æ®µ
- ğŸ”„ **å®Œå…¨é€ä¼ ** - å®¢æˆ·ç«¯å‘ä»€ä¹ˆå°±è½¬å‘ä»€ä¹ˆ
- ğŸ›¡ï¸ **å¤´ä¿¡æ¯ä¿æŠ¤** - ä¸ä¿®æ”¹anthropic-betaç­‰æ¨ç†ç›¸å…³å¤´ä¿¡æ¯

**ä½¿ç”¨åœºæ™¯**ï¼š
- å®¢æˆ·ç«¯éœ€è¦å®Œå…¨æ§åˆ¶æ¨ç†å‚æ•°
- ä¸åŸå§‹APIè¡Œä¸ºä¿æŒ100%ä¸€è‡´
- ä¸åŒå®¢æˆ·ç«¯æœ‰ä¸åŒçš„æ¨ç†éœ€æ±‚

**ç¤ºä¾‹å¯¹æ¯”**ï¼š
```bash
# å®¢æˆ·ç«¯è¯·æ±‚åŒ…å«æ¨ç†å­—æ®µ
{
  "model": "claude-opus-4-1-20250805",
  "reasoning": "auto",           // é…ç½®ä¸ºauto
  "messages": [...],
  "thinking": {"type": "enabled", "budget_tokens": 8192}
}

# autoæ¨¡å¼ï¼šå®Œå…¨ä¿ç•™å®¢æˆ·ç«¯è®¾ç½®
â†’ thinkingå­—æ®µåŸæ ·è½¬å‘ï¼Œä¸åšä»»ä½•ä¿®æ”¹

# å¦‚æœé…ç½®ä¸º"high"ï¼šä¼šè¢«è¦†ç›–ä¸º {"type": "enabled", "budget_tokens": 24576}
```

### å¦‚ä½•é…ç½®æ¨ç†çº§åˆ«ï¼Ÿ

åœ¨ `config.json` ä¸­ä¸ºæ¯ä¸ªæ¨¡å‹è®¾ç½® `reasoning` å­—æ®µï¼š

```json
{
  "models": [
    {
      "id": "claude-opus-4-1-20250805", 
      "type": "anthropic",
      "reasoning": "auto"  // auto/off/low/medium/high
    }
  ]
}
```

**æ¨ç†çº§åˆ«è¯´æ˜**ï¼š

| çº§åˆ« | è¡Œä¸º | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `auto` | å®Œå…¨éµå¾ªå®¢æˆ·ç«¯åŸå§‹è¯·æ±‚å‚æ•° | è®©å®¢æˆ·ç«¯è‡ªä¸»æ§åˆ¶æ¨ç† |
| `off` | å¼ºåˆ¶ç¦ç”¨æ¨ç†ï¼Œåˆ é™¤æ‰€æœ‰æ¨ç†å­—æ®µ | å¿«é€Ÿå“åº”åœºæ™¯ |
| `low` | è½»åº¦æ¨ç† (4096 tokens) | ç®€å•ä»»åŠ¡ |
| `medium` | ä¸­åº¦æ¨ç† (12288 tokens) | å¹³è¡¡æ€§èƒ½ä¸è´¨é‡ |
| `high` | æ·±åº¦æ¨ç† (24576 tokens) | å¤æ‚ä»»åŠ¡ |

### ä»¤ç‰Œå¤šä¹…åˆ·æ–°ä¸€æ¬¡ï¼Ÿ

ç³»ç»Ÿæ¯6å°æ—¶è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡è®¿é—®ä»¤ç‰Œã€‚åˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæœŸä¸º8å°æ—¶ï¼Œç¡®ä¿æœ‰2å°æ—¶çš„ç¼“å†²æ—¶é—´ã€‚

### å¦‚ä½•æ£€æŸ¥ä»¤ç‰ŒçŠ¶æ€ï¼Ÿ

æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼ŒæˆåŠŸåˆ·æ–°æ—¶ä¼šæ˜¾ç¤ºï¼š
```
Token refreshed successfully, expires at: 2025-01-XX XX:XX:XX
```

### Claude Codeæ— æ³•è¿æ¥æ€ä¹ˆåŠï¼Ÿ

1. ç¡®ä¿droid2apiæœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼š`curl http://localhost:3000/v1/models`
2. æ£€æŸ¥Claude Codeçš„API Base URLè®¾ç½®
3. ç¡®è®¤é˜²ç«å¢™æ²¡æœ‰é˜»æ­¢ç«¯å£3000

### æ¨ç†åŠŸèƒ½ä¸ºä»€ä¹ˆæ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ

**å¦‚æœæ¨ç†çº§åˆ«è®¾ç½®æ— æ•ˆ**ï¼š
1. æ£€æŸ¥æ¨¡å‹é…ç½®ä¸­çš„ `reasoning` å­—æ®µæ˜¯å¦ä¸ºæœ‰æ•ˆå€¼ (`auto/off/low/medium/high`)
2. ç¡®è®¤æ¨¡å‹IDæ˜¯å¦æ­£ç¡®åŒ¹é…config.jsonä¸­çš„é…ç½®
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ç¡®è®¤æ¨ç†å­—æ®µæ˜¯å¦æ­£ç¡®å¤„ç†

**å¦‚æœä½¿ç”¨autoæ¨¡å¼ä½†æ¨ç†ä¸ç”Ÿæ•ˆ**ï¼š
1. ç¡®è®¤å®¢æˆ·ç«¯è¯·æ±‚ä¸­åŒ…å«äº†æ¨ç†å­—æ®µ (`reasoning` æˆ– `thinking`)
2. autoæ¨¡å¼ä¸ä¼šæ·»åŠ æ¨ç†å­—æ®µï¼Œåªä¼šä¿ç•™å®¢æˆ·ç«¯åŸæœ‰çš„è®¾ç½®
3. å¦‚éœ€å¼ºåˆ¶æ¨ç†ï¼Œè¯·æ”¹ç”¨ `low/medium/high` çº§åˆ«

**æ¨ç†å­—æ®µå¯¹åº”å…³ç³»**ï¼š
- OpenAIæ¨¡å‹ (`gpt-*`) â†’ ä½¿ç”¨ `reasoning` å­—æ®µ
- Anthropicæ¨¡å‹ (`claude-*`) â†’ ä½¿ç”¨ `thinking` å­—æ®µ

### å¦‚ä½•æ›´æ”¹ç«¯å£ï¼Ÿ

ç¼–è¾‘ `config.json` ä¸­çš„ `port` å­—æ®µï¼š

```json
{
  "port": 8080
}
```

### å¦‚ä½•å¯ç”¨è°ƒè¯•æ—¥å¿—ï¼Ÿ

åœ¨ `config.json` ä¸­è®¾ç½®ï¼š

```json
{
  "dev_mode": true
}
```

## æ•…éšœæ’æŸ¥

### è®¤è¯å¤±è´¥

ç¡®ä¿å·²æ­£ç¡®é…ç½® refresh tokenï¼š
- è®¾ç½®ç¯å¢ƒå˜é‡ `DROID_REFRESH_KEY`
- æˆ–åˆ›å»º `~/.factory/auth.json` æ–‡ä»¶

### æ¨¡å‹ä¸å¯ç”¨

æ£€æŸ¥ `config.json` ä¸­çš„æ¨¡å‹é…ç½®ï¼Œç¡®ä¿æ¨¡å‹ ID å’Œç±»å‹æ­£ç¡®ã€‚

## è®¸å¯è¯

MIT
